<?php

declare(strict_types=1);

namespace Anthropic\Beta\Messages;

use Anthropic\Beta\Messages\BetaServerToolUseBlock\Name;
use Anthropic\Beta\Messages\BetaUsage\ServiceTier;
use Anthropic\Core\Attributes\Required;
use Anthropic\Core\Concerns\SdkModel;
use Anthropic\Core\Contracts\BaseModel;
use Anthropic\Messages\Model;

/**
 * @phpstan-type BetaMessageShape = array{
 *   id: string,
 *   container: BetaContainer|null,
 *   content: list<BetaTextBlock|BetaThinkingBlock|BetaRedactedThinkingBlock|BetaToolUseBlock|BetaServerToolUseBlock|BetaWebSearchToolResultBlock|BetaWebFetchToolResultBlock|BetaCodeExecutionToolResultBlock|BetaBashCodeExecutionToolResultBlock|BetaTextEditorCodeExecutionToolResultBlock|BetaToolSearchToolResultBlock|BetaMCPToolUseBlock|BetaMCPToolResultBlock|BetaContainerUploadBlock>,
 *   context_management: BetaContextManagementResponse|null,
 *   model: string|value-of<Model>,
 *   role: 'assistant',
 *   stop_reason: value-of<BetaStopReason>|null,
 *   stop_sequence: string|null,
 *   type: 'message',
 *   usage: BetaUsage,
 * }
 */
final class BetaMessage implements BaseModel
{
    /** @use SdkModel<BetaMessageShape> */
    use SdkModel;

    /**
     * Conversational role of the generated message.
     *
     * This will always be `"assistant"`.
     *
     * @var 'assistant' $role
     */
    #[Required]
    public string $role = 'assistant';

    /**
     * Object type.
     *
     * For Messages, this is always `"message"`.
     *
     * @var 'message' $type
     */
    #[Required]
    public string $type = 'message';

    /**
     * Unique object identifier.
     *
     * The format and length of IDs may change over time.
     */
    #[Required]
    public string $id;

    /**
     * Information about the container used in the request (for the code execution tool).
     */
    #[Required]
    public ?BetaContainer $container;

    /**
     * Content generated by the model.
     *
     * This is an array of content blocks, each of which has a `type` that determines its shape.
     *
     * Example:
     *
     * ```json
     * [{"type": "text", "text": "Hi, I'm Claude."}]
     * ```
     *
     * If the request input `messages` ended with an `assistant` turn, then the response `content` will continue directly from that last turn. You can use this to constrain the model's output.
     *
     * For example, if the input `messages` were:
     * ```json
     * [
     *   {"role": "user", "content": "What's the Greek name for Sun? (A) Sol (B) Helios (C) Sun"},
     *   {"role": "assistant", "content": "The best answer is ("}
     * ]
     * ```
     *
     * Then the response `content` might be:
     *
     * ```json
     * [{"type": "text", "text": "B)"}]
     * ```
     *
     * @var list<BetaTextBlock|BetaThinkingBlock|BetaRedactedThinkingBlock|BetaToolUseBlock|BetaServerToolUseBlock|BetaWebSearchToolResultBlock|BetaWebFetchToolResultBlock|BetaCodeExecutionToolResultBlock|BetaBashCodeExecutionToolResultBlock|BetaTextEditorCodeExecutionToolResultBlock|BetaToolSearchToolResultBlock|BetaMCPToolUseBlock|BetaMCPToolResultBlock|BetaContainerUploadBlock> $content
     */
    #[Required(list: BetaContentBlock::class)]
    public array $content;

    /**
     * Context management response.
     *
     * Information about context management strategies applied during the request.
     */
    #[Required]
    public ?BetaContextManagementResponse $context_management;

    /**
     * The model that will complete your prompt.\n\nSee [models](https://docs.anthropic.com/en/docs/models-overview) for additional details and options.
     *
     * @var string|value-of<Model> $model
     */
    #[Required(enum: Model::class)]
    public string $model;

    /**
     * The reason that we stopped.
     *
     * This may be one the following values:
     * * `"end_turn"`: the model reached a natural stopping point
     * * `"max_tokens"`: we exceeded the requested `max_tokens` or the model's maximum
     * * `"stop_sequence"`: one of your provided custom `stop_sequences` was generated
     * * `"tool_use"`: the model invoked one or more tools
     * * `"pause_turn"`: we paused a long-running turn. You may provide the response back as-is in a subsequent request to let the model continue.
     * * `"refusal"`: when streaming classifiers intervene to handle potential policy violations
     *
     * In non-streaming mode this value is always non-null. In streaming mode, it is null in the `message_start` event and non-null otherwise.
     *
     * @var value-of<BetaStopReason>|null $stop_reason
     */
    #[Required(enum: BetaStopReason::class)]
    public ?string $stop_reason;

    /**
     * Which custom stop sequence was generated, if any.
     *
     * This value will be a non-null string if one of your custom stop sequences was generated.
     */
    #[Required]
    public ?string $stop_sequence;

    /**
     * Billing and rate-limit usage.
     *
     * Anthropic's API bills and rate-limits by token counts, as tokens represent the underlying cost to our systems.
     *
     * Under the hood, the API transforms requests into a format suitable for the model. The model's output then goes through a parsing stage before becoming an API response. As a result, the token counts in `usage` will not match one-to-one with the exact visible content of an API request or response.
     *
     * For example, `output_tokens` will be non-zero, even for an empty string response from Claude.
     *
     * Total input tokens in a request is the summation of `input_tokens`, `cache_creation_input_tokens`, and `cache_read_input_tokens`.
     */
    #[Required]
    public BetaUsage $usage;

    /**
     * `new BetaMessage()` is missing required properties by the API.
     *
     * To enforce required parameters use
     * ```
     * BetaMessage::with(
     *   id: ...,
     *   container: ...,
     *   content: ...,
     *   context_management: ...,
     *   model: ...,
     *   stop_reason: ...,
     *   stop_sequence: ...,
     *   usage: ...,
     * )
     * ```
     *
     * Otherwise ensure the following setters are called
     *
     * ```
     * (new BetaMessage)
     *   ->withID(...)
     *   ->withContainer(...)
     *   ->withContent(...)
     *   ->withContextManagement(...)
     *   ->withModel(...)
     *   ->withStopReason(...)
     *   ->withStopSequence(...)
     *   ->withUsage(...)
     * ```
     */
    public function __construct()
    {
        $this->initialize();
    }

    /**
     * Construct an instance from the required parameters.
     *
     * You must use named parameters to construct any parameters with a default value.
     *
     * @param BetaContainer|array{
     *   id: string, expires_at: \DateTimeInterface, skills: list<BetaSkill>|null
     * }|null $container
     * @param list<BetaTextBlock|array{
     *   citations: list<BetaCitationCharLocation|BetaCitationPageLocation|BetaCitationContentBlockLocation|BetaCitationsWebSearchResultLocation|BetaCitationSearchResultLocation>|null,
     *   text: string,
     *   type: 'text',
     * }|BetaThinkingBlock|array{
     *   signature: string, thinking: string, type: 'thinking'
     * }|BetaRedactedThinkingBlock|array{
     *   data: string, type: 'redacted_thinking'
     * }|BetaToolUseBlock|array{
     *   id: string,
     *   input: array<string,mixed>,
     *   name: string,
     *   type: 'tool_use',
     *   caller?: BetaDirectCaller|BetaServerToolCaller|null,
     * }|BetaServerToolUseBlock|array{
     *   id: string,
     *   caller: BetaDirectCaller|BetaServerToolCaller,
     *   input: array<string,mixed>,
     *   name: value-of<Name>,
     *   type: 'server_tool_use',
     * }|BetaWebSearchToolResultBlock|array{
     *   content: BetaWebSearchToolResultError|list<BetaWebSearchResultBlock>,
     *   tool_use_id: string,
     *   type: 'web_search_tool_result',
     * }|BetaWebFetchToolResultBlock|array{
     *   content: BetaWebFetchToolResultErrorBlock|BetaWebFetchBlock,
     *   tool_use_id: string,
     *   type: 'web_fetch_tool_result',
     * }|BetaCodeExecutionToolResultBlock|array{
     *   content: BetaCodeExecutionToolResultError|BetaCodeExecutionResultBlock,
     *   tool_use_id: string,
     *   type: 'code_execution_tool_result',
     * }|BetaBashCodeExecutionToolResultBlock|array{
     *   content: BetaBashCodeExecutionToolResultError|BetaBashCodeExecutionResultBlock,
     *   tool_use_id: string,
     *   type: 'bash_code_execution_tool_result',
     * }|BetaTextEditorCodeExecutionToolResultBlock|array{
     *   content: BetaTextEditorCodeExecutionToolResultError|BetaTextEditorCodeExecutionViewResultBlock|BetaTextEditorCodeExecutionCreateResultBlock|BetaTextEditorCodeExecutionStrReplaceResultBlock,
     *   tool_use_id: string,
     *   type: 'text_editor_code_execution_tool_result',
     * }|BetaToolSearchToolResultBlock|array{
     *   content: BetaToolSearchToolResultError|BetaToolSearchToolSearchResultBlock,
     *   tool_use_id: string,
     *   type: 'tool_search_tool_result',
     * }|BetaMCPToolUseBlock|array{
     *   id: string,
     *   input: array<string,mixed>,
     *   name: string,
     *   server_name: string,
     *   type: 'mcp_tool_use',
     * }|BetaMCPToolResultBlock|array{
     *   content: string|list<BetaTextBlock>,
     *   is_error: bool,
     *   tool_use_id: string,
     *   type: 'mcp_tool_result',
     * }|BetaContainerUploadBlock|array{
     *   file_id: string, type: 'container_upload'
     * }> $content
     * @param BetaContextManagementResponse|array{
     *   applied_edits: list<BetaClearToolUses20250919EditResponse|BetaClearThinking20251015EditResponse>,
     * }|null $context_management
     * @param BetaStopReason|value-of<BetaStopReason>|null $stop_reason
     * @param BetaUsage|array{
     *   cache_creation: BetaCacheCreation|null,
     *   cache_creation_input_tokens: int|null,
     *   cache_read_input_tokens: int|null,
     *   input_tokens: int,
     *   output_tokens: int,
     *   server_tool_use: BetaServerToolUsage|null,
     *   service_tier: value-of<ServiceTier>|null,
     * } $usage
     */
    public static function with(
        string $id,
        BetaContainer|array|null $container,
        array $content,
        BetaContextManagementResponse|array|null $context_management,
        string|Model $model,
        BetaStopReason|string|null $stop_reason,
        ?string $stop_sequence,
        BetaUsage|array $usage,
    ): self {
        $obj = new self;

        $obj['id'] = $id;
        $obj['container'] = $container;
        $obj['content'] = $content;
        $obj['context_management'] = $context_management;
        $obj['model'] = $model;
        $obj['stop_reason'] = $stop_reason;
        $obj['stop_sequence'] = $stop_sequence;
        $obj['usage'] = $usage;

        return $obj;
    }

    /**
     * Unique object identifier.
     *
     * The format and length of IDs may change over time.
     */
    public function withID(string $id): self
    {
        $obj = clone $this;
        $obj['id'] = $id;

        return $obj;
    }

    /**
     * Information about the container used in the request (for the code execution tool).
     *
     * @param BetaContainer|array{
     *   id: string, expires_at: \DateTimeInterface, skills: list<BetaSkill>|null
     * }|null $container
     */
    public function withContainer(BetaContainer|array|null $container): self
    {
        $obj = clone $this;
        $obj['container'] = $container;

        return $obj;
    }

    /**
     * Content generated by the model.
     *
     * This is an array of content blocks, each of which has a `type` that determines its shape.
     *
     * Example:
     *
     * ```json
     * [{"type": "text", "text": "Hi, I'm Claude."}]
     * ```
     *
     * If the request input `messages` ended with an `assistant` turn, then the response `content` will continue directly from that last turn. You can use this to constrain the model's output.
     *
     * For example, if the input `messages` were:
     * ```json
     * [
     *   {"role": "user", "content": "What's the Greek name for Sun? (A) Sol (B) Helios (C) Sun"},
     *   {"role": "assistant", "content": "The best answer is ("}
     * ]
     * ```
     *
     * Then the response `content` might be:
     *
     * ```json
     * [{"type": "text", "text": "B)"}]
     * ```
     *
     * @param list<BetaTextBlock|array{
     *   citations: list<BetaCitationCharLocation|BetaCitationPageLocation|BetaCitationContentBlockLocation|BetaCitationsWebSearchResultLocation|BetaCitationSearchResultLocation>|null,
     *   text: string,
     *   type: 'text',
     * }|BetaThinkingBlock|array{
     *   signature: string, thinking: string, type: 'thinking'
     * }|BetaRedactedThinkingBlock|array{
     *   data: string, type: 'redacted_thinking'
     * }|BetaToolUseBlock|array{
     *   id: string,
     *   input: array<string,mixed>,
     *   name: string,
     *   type: 'tool_use',
     *   caller?: BetaDirectCaller|BetaServerToolCaller|null,
     * }|BetaServerToolUseBlock|array{
     *   id: string,
     *   caller: BetaDirectCaller|BetaServerToolCaller,
     *   input: array<string,mixed>,
     *   name: value-of<Name>,
     *   type: 'server_tool_use',
     * }|BetaWebSearchToolResultBlock|array{
     *   content: BetaWebSearchToolResultError|list<BetaWebSearchResultBlock>,
     *   tool_use_id: string,
     *   type: 'web_search_tool_result',
     * }|BetaWebFetchToolResultBlock|array{
     *   content: BetaWebFetchToolResultErrorBlock|BetaWebFetchBlock,
     *   tool_use_id: string,
     *   type: 'web_fetch_tool_result',
     * }|BetaCodeExecutionToolResultBlock|array{
     *   content: BetaCodeExecutionToolResultError|BetaCodeExecutionResultBlock,
     *   tool_use_id: string,
     *   type: 'code_execution_tool_result',
     * }|BetaBashCodeExecutionToolResultBlock|array{
     *   content: BetaBashCodeExecutionToolResultError|BetaBashCodeExecutionResultBlock,
     *   tool_use_id: string,
     *   type: 'bash_code_execution_tool_result',
     * }|BetaTextEditorCodeExecutionToolResultBlock|array{
     *   content: BetaTextEditorCodeExecutionToolResultError|BetaTextEditorCodeExecutionViewResultBlock|BetaTextEditorCodeExecutionCreateResultBlock|BetaTextEditorCodeExecutionStrReplaceResultBlock,
     *   tool_use_id: string,
     *   type: 'text_editor_code_execution_tool_result',
     * }|BetaToolSearchToolResultBlock|array{
     *   content: BetaToolSearchToolResultError|BetaToolSearchToolSearchResultBlock,
     *   tool_use_id: string,
     *   type: 'tool_search_tool_result',
     * }|BetaMCPToolUseBlock|array{
     *   id: string,
     *   input: array<string,mixed>,
     *   name: string,
     *   server_name: string,
     *   type: 'mcp_tool_use',
     * }|BetaMCPToolResultBlock|array{
     *   content: string|list<BetaTextBlock>,
     *   is_error: bool,
     *   tool_use_id: string,
     *   type: 'mcp_tool_result',
     * }|BetaContainerUploadBlock|array{
     *   file_id: string, type: 'container_upload'
     * }> $content
     */
    public function withContent(array $content): self
    {
        $obj = clone $this;
        $obj['content'] = $content;

        return $obj;
    }

    /**
     * Context management response.
     *
     * Information about context management strategies applied during the request.
     *
     * @param BetaContextManagementResponse|array{
     *   applied_edits: list<BetaClearToolUses20250919EditResponse|BetaClearThinking20251015EditResponse>,
     * }|null $contextManagement
     */
    public function withContextManagement(
        BetaContextManagementResponse|array|null $contextManagement
    ): self {
        $obj = clone $this;
        $obj['context_management'] = $contextManagement;

        return $obj;
    }

    /**
     * The model that will complete your prompt.\n\nSee [models](https://docs.anthropic.com/en/docs/models-overview) for additional details and options.
     */
    public function withModel(string|Model $model): self
    {
        $obj = clone $this;
        $obj['model'] = $model;

        return $obj;
    }

    /**
     * The reason that we stopped.
     *
     * This may be one the following values:
     * * `"end_turn"`: the model reached a natural stopping point
     * * `"max_tokens"`: we exceeded the requested `max_tokens` or the model's maximum
     * * `"stop_sequence"`: one of your provided custom `stop_sequences` was generated
     * * `"tool_use"`: the model invoked one or more tools
     * * `"pause_turn"`: we paused a long-running turn. You may provide the response back as-is in a subsequent request to let the model continue.
     * * `"refusal"`: when streaming classifiers intervene to handle potential policy violations
     *
     * In non-streaming mode this value is always non-null. In streaming mode, it is null in the `message_start` event and non-null otherwise.
     *
     * @param BetaStopReason|value-of<BetaStopReason>|null $stopReason
     */
    public function withStopReason(BetaStopReason|string|null $stopReason): self
    {
        $obj = clone $this;
        $obj['stop_reason'] = $stopReason;

        return $obj;
    }

    /**
     * Which custom stop sequence was generated, if any.
     *
     * This value will be a non-null string if one of your custom stop sequences was generated.
     */
    public function withStopSequence(?string $stopSequence): self
    {
        $obj = clone $this;
        $obj['stop_sequence'] = $stopSequence;

        return $obj;
    }

    /**
     * Billing and rate-limit usage.
     *
     * Anthropic's API bills and rate-limits by token counts, as tokens represent the underlying cost to our systems.
     *
     * Under the hood, the API transforms requests into a format suitable for the model. The model's output then goes through a parsing stage before becoming an API response. As a result, the token counts in `usage` will not match one-to-one with the exact visible content of an API request or response.
     *
     * For example, `output_tokens` will be non-zero, even for an empty string response from Claude.
     *
     * Total input tokens in a request is the summation of `input_tokens`, `cache_creation_input_tokens`, and `cache_read_input_tokens`.
     *
     * @param BetaUsage|array{
     *   cache_creation: BetaCacheCreation|null,
     *   cache_creation_input_tokens: int|null,
     *   cache_read_input_tokens: int|null,
     *   input_tokens: int,
     *   output_tokens: int,
     *   server_tool_use: BetaServerToolUsage|null,
     *   service_tier: value-of<ServiceTier>|null,
     * } $usage
     */
    public function withUsage(BetaUsage|array $usage): self
    {
        $obj = clone $this;
        $obj['usage'] = $usage;

        return $obj;
    }
}
